@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title C3 Component: Backend API

Container_Boundary(backend, "Backend API") {
    Component(router, "HTTP Router", "Golang", "Маршрутизация HTTP")

    Component(handlers, "API Handlers", "Golang", "REST-контроллеры")

    Component(analytics_service, "Analytics Service", "Golang", "Вычисление метрик по запросу пользователя")

    Component(cache_service, "Cache Service", "Golang", "Кэширование результатов аналитики, инвалидация при обновлении данных")

    Component(sync_service, "Sync Service", "Golang", "Управление синхронизацией данных с Jira")

    Component(postgres_repo, "PostgreSQL Repository", "Golang, pgx", "Доступ к данным: issues, changelogs, projects")

    Component(cache_repo, "Cache Repository", "Golang, go-redis", "Доступ к кэшу аналитических результатов")
}

Container(webapp, "Web Application", "Angular", "SPA")
Container(connector, "Jira Connector", "Golang", "Загрузка данных из Jira")
ContainerDb(postgres, "PostgreSQL", "SQL Database", "Сырые данные")
ContainerDb(redis, "Redis", "In-Memory Cache", "Кэш вычисленной аналитики")

Rel(webapp, router, "HTTP-запросы", "REST API")
Rel(router, handlers, "Направляет запросы")

Rel(handlers, analytics_service, "Запрос метрик")
Rel(handlers, sync_service, "Команда на синхронизацию")

Rel(analytics_service, cache_service, "Проверка/сохранение кэша")
Rel(analytics_service, postgres_repo, "Чтение данных для расчётов")

Rel(cache_service, cache_repo, "Get/Set кэша")

Rel(sync_service, connector, "Запуск загрузки", "HTTP")

Rel(postgres_repo, postgres, "SQL-запросы", "TCP")
Rel(cache_repo, redis, "GET/SET", "TCP")

@enduml
