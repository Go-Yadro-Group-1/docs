@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title C3 Component: Jira Connector

Container_Boundary(connector, "Jira Connector") {
    Component(queue_consumer, "Queue Consumer", "Golang", "AMQP-клиент для получения задач на синхронизацию")
    Component(queue_publisher, "Queue Publisher", "Golang", "AMQP-клиент для публикации результатов")

    Component(sync_service, "Sync Service", "Golang", "Бизнес-логика управления процессом синхронизации")

    Component(jira_client, "Jira API Client", "Golang", "HTTP-клиент для Jira REST API v2")
    Component(data_mapper, "Data Mapper", "Golang", "Нормализация сырых JSON в доменные модели")
    Component(postgres_repo, "PostgreSQL Repository", "Golang, pgx", "Сохранение нормализованных данных")
}

ContainerQueue(queue, "RabbitMQ", "Broker/Queue", "Используется для межсервисного взаимодействия")
ContainerDb(postgres, "PostgreSQL", "SQL Database", "Хранит сырые данные по задачам")
System_Ext(jira, "Atlassian Jira", "Внешняя система управления задачами")

Rel_U(queue, queue_consumer, "AMQP", "Получение задач на синхронизацию")
Rel_D(queue_consumer, sync_service, "", "Передача задач")

Rel_D(sync_service, jira_client, "", "Запрос данных из Jira")
Rel_D(jira_client, jira, "REST API", "GET /rest/api/2/issue, /project, /changelog")
Rel_D(sync_service, data_mapper, "", "Нормализация данных")
Rel_D(sync_service, postgres_repo, "", "Сохранение данных")
Rel_U(sync_service, queue_publisher, "", "Отправка результатов")

Rel_D(postgres_repo, postgres, "SQL", "INSERT/UPDATE")

Rel_U(queue_publisher, queue, "AMQP", "Публикация результатов синхронизации")

@enduml
